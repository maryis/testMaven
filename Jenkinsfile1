pipeline {
    agent any 
    stages {

     stage('compile') {

        steps {
                sh 'mvn compile' 
            }
        }

     stage('test') {
            steps {
                sh 'mvn test' 
            }
        }

     stage('code_review') {
            steps {
                sh 'mvn pmd:pmd' 
            }
        }

     stage('package') {
            steps {
                sh 'mvn package' 
            }
        }     

     stage('run') {

	agent{
    		// Equivalent to "docker build -f Dockerfile.build --build-arg version=1.0.2 ./build/
     		dockerfile {
        		filename 'Dockerfile' // optional because file name is standars
        		// dir 'build' if dockerfile is not in root
        		label 'myapp'
        		additionalBuildArgs  '--build-arg version=1.0'
        		//args '-v /tmp:/tmp'
    		}
	    }
            steps {
                sh 'echo END'  //run inside container
            }
        }
    }
}
